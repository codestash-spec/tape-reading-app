{
  "summary": "Audit of institutional tape-reading app after recent mega-prompts; many scaffolds exist but several advanced requirements remain unimplemented or partially integrated.",
  "implemented": {
    "event_bus_safety": [
      "allowed_sources gate to drop ghost events",
      "duplicate callback warning and subscriber counting",
      "unsubscribe support on EventBridge and providers"
    ],
    "provider_layer": [
      "ProviderBase stop logic with thread join and unsubscribe hooks",
      "ProviderManager auto-detect via core/instrument_detector, allowed_sources reset, audit logging",
      "Mock providers for IBKR (FX/CFD/FUTURES placeholder), CME, Binance, OKX, SIM with debug logging"
    ],
    "ui_shell": [
      "DockArea layout with dockable panels",
      "MarketWatch panel with presets, favorites, add instrument dialog, watchlists.json persistence, hotkeys Ctrl+1/2, provider-aware price updates",
      "EventBridge unsubscribes on stop and emits log events",
      "Toolbar/menu wiring, status bar, basic chart scatter for fills"
    ],
    "new_panels_scaffold": [
      "LiquidityMapPanel, VolumeProfilePanel, RegimePanel, VolatilityPanel, HeatmapPanel, AlertsPanel placeholders wired into main window",
      "MarketWatch dock placed left of DOM"
    ],
    "engines_scaffold": [
      "LiquidityMapEngine (resting liquidity tracking, publishes liquidity_update)",
      "VolumeProfileEngine (histogram, POC, value area, publishes volume_profile_update)",
      "VolatilityEngine (ATR-like range, publishes volatility_update)",
      "RegimeEngine (simple regime classification from volatility/microstructure)"
    ],
    "tests_added": [
      "test_provider_switch_stress (50 switches) and integrity/latency mocks",
      "test_marketwatch (UI apply/price update)",
      "autodetect/execution routing/IBKR futures depth stubs",
      "UI latency mock and panel basic tests"
    ],
    "audit_mode": [
      "ProviderManager audit logs threads/callbacks before/after",
      "switching_report.json produced by stress test"
    ]
  },
  "incomplete": {
    "engines_integration": [
      "New engines (liquidity_map, volume_profile, volatility, regime) are not instantiated or subscribed in ui/app/main.py; events not flowing to UI panels.",
      "Spoofing/Iceberg/LargeTrade detectors requested are absent as standalone modules; only basic signals in engines/liquidity/engine.py."
    ],
    "ui_performance": [
      "No render throttling, drag/resizing pause, or update suspension implemented.",
      "No OpenGL accelerated widgets or double buffering applied; pyqtgraph options not tuned for large arrays.",
      "DockArea used but no logic to pause updates during drag/move/resize; FPS metrics not captured."
    ],
    "ui_features": [
      "Heatmap DOM/Footprint advanced rendering not implemented; panels are placeholders.",
      "Alerts panel, liquidity/volume/regime/volatility panels do not render data.",
      "Order ticket pro enhancements not added; execution map minimal.",
      "Layout presets saved only via WorkspaceManager default; layouts.json not present."
    ],
    "provider_behavior": [
      "IBKR provider still mock; no real reqMktDepth or tick-by-tick wiring; futures mode placeholder.",
      "Binance/OKX providers do not open real WebSockets; depth100/trade mapping not present.",
      "Provider stop may leave running tasks in concrete providers (no websocket/task cancellation logic beyond thread join).",
      "ProviderManager _assert_provider_dead only logs; not preventing leaks."
    ],
    "auto_detection": [
      "instrument_detector not invoked in ui/main_window switching; rebuild of ProviderManager ignores execution_symbol/provider separation.",
      "EventBridge reconnect on provider switch does not clear MarketWatch subscriptions (no disconnect usage)."
    ],
    "tests_gaps": [
      "No tests for new engines (liquidity_map, volume_profile, volatility, regime) or detectors.",
      "No UI dock performance test, throttling test, or hotkey/provider switching under heavy load.",
      "No audit of ghost event drops beyond subscriber count."
    ],
    "logging_and_debug": [
      "Provider debug/audit flags set in settings but not consistently honored across providers.",
      "No FPS/latency metrics emitted to metrics panel; metrics panel remains empty."
    ]
  },
  "missing": {
    "institutional_detectors": [
      "Dedicated spoofing_detector.py, iceberg_detector.py, large_trade_detector.py not present.",
      "Footprint clustering, delta divergence markers, liquidity map heat rendering absent."
    ],
    "ui_advanced": [
      "DOM heatmap Bookmap-style, throttled rendering, OpenGL widgets, double buffering not implemented.",
      "Render suspension during drag/resize and FPS throttling not present.",
      "Buttons for minimize/maximize/undock per panel not added beyond DockArea defaults.",
      "MarketWatch hotkeys only cycle rows; no previous/next instrument list integration across presets."
    ],
    "provider_exec_separation": [
      "Execution provider separation (market_symbol vs execution_symbol) not enforced in router.",
      "No health endpoints/watchdogs or CI/CD workflow requested in earlier prompts."
    ],
    "performance_profile": [
      "No measured FPS/latency numbers; no load/perf report produced.",
      "UI latency under drag and provider switching not instrumented."
    ]
  },
  "consistency_checks": {
    "event_bus": "Ghost-event filter and duplicate warning exist; no evidence of throttling or backpressure; EventBridge double stop removed duplicates.",
    "ui_handlers": "Core panels connected to EventBridge; new panels mostly placeholders and do not subscribe to new events.",
    "providers": "Registered in ProviderManager; start/stop wraps allowed_sources; websockets and IBKR depth remain mocked.",
    "market_watch": "Operates, persists watchlists.json, emits instrumentSelected; does not disconnect bridge on provider rebuild unless called manually.",
    "docking": "DockArea in use; no drag/resize suspension or throttling implemented."
  },
  "recommendations": {
    "wire_engines": "Instantiate LiquidityMapEngine, VolumeProfileEngine, VolatilityEngine, RegimeEngine in app/main and connect UI panels to new event types.",
    "implement_detectors": "Add spoofing_detector.py, iceberg_detector.py, large_trade_detector.py with EventBus outputs and UI alerts panel consumption.",
    "ui_perf": "Add render throttling, drag-pause flags, OpenGL-backed widgets, double buffering, and FPS metrics; implement pyqtgraph downsampling.",
    "providers_real": "Implement real Binance/OKX websocket clients and IBKR depth/tick-by-tick; ensure stop cancels tasks and unsubscribes.",
    "provider_switch": "Use instrument_detector on UI switch; disconnect/reconnect MarketWatch bridge; enforce allowed_sources per provider.",
    "tests": "Add engine coverage, UI dock performance, provider switch stress to 200 cycles, ghost-event guards, and alerts panel rendering tests.",
    "metrics": "Emit latency/FPS/event-rate metrics to metrics panel; add audit of render time during drag."
  },
  "next_steps": [
    "Design and implement real data adapters with async websockets and proper stop/cleanup.",
    "Complete UI advanced rendering (heatmaps, throttling, OpenGL) and tie new engines to panels.",
    "Add regression tests for new features and performance thresholds; automate audit report generation.",
    "Integrate execution/market provider separation in router and settings; honor audit/debug flags consistently."
  ]
}
